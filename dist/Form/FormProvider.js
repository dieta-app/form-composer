"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard");Object.defineProperty(exports,"__esModule",{value:true});exports.FormConsumer=exports.FormProvider=exports.FormContext=void 0;var _typeof2=_interopRequireDefault(require("@babel/runtime/helpers/typeof"));var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));var _assertThisInitialized2=_interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));var _inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits"));var _possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));var _getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));var _defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));var _react=_interopRequireWildcard(require("react"));var _styledComponents=_interopRequireDefault(require("styled-components"));var _propTypes=_interopRequireDefault(require("prop-types"));var _jsxFileName="/Users/bneigher/Desktop/Dieta/form-composer/src/Form/FormProvider.js";function _createForOfIteratorHelperLoose(o){var i=0;if(typeof Symbol==="undefined"||o[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]==null){if(Array.isArray(o)||(o=_unsupportedIterableToArray(o)))return function(){if(i>=o.length)return{done:true};return{done:false,value:o[i++]};};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}i=o[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();return i.next.bind(i);}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen);}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i];}return arr2;}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){(0,_defineProperty2.default)(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function(){var Super=(0,_getPrototypeOf2.default)(Derived),result;if(hasNativeReflectConstruct){var NewTarget=(0,_getPrototypeOf2.default)(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return(0,_possibleConstructorReturn2.default)(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true;}catch(e){return false;}}var FormContext=_react.default.createContext();exports.FormContext=FormContext;var FormProvider=function(_Component){(0,_inherits2.default)(FormProvider,_Component);var _super=_createSuper(FormProvider);function FormProvider(){var _this;(0,_classCallCheck2.default)(this,FormProvider);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),"state",{currentState:_this.props.currentState,activeStateContent:{},depths:[],ordering:[]});(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),"componentDidMount",function(){_this.initialize(_this.props.states);});(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),"initialize",function(states){var organization=_this.groupIndicatorSections(states);var activeStateContent=_this.deepTraverseStatesGet(states,_this.state.currentState);var complete=_this.checkStateComplete(activeStateContent.answer);_this.setState({states:states,activeStateContent:_objectSpread(_objectSpread({},activeStateContent),{},{complete:complete}),depths:organization.depths,ordering:organization.ordering});});(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),"insertStateDepth",function(states){var ordering=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];var depths=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];var depth=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;states.forEach(function(state){ordering.push(state.step);if(!depths[depth]){depths.push([]);}depths[depth].push(state);if(state.states&&state.states.length){_this.insertStateDepth(state.states,ordering,depths,depth+1);}});return{depths:depths,ordering:ordering};});(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),"groupIndicatorSections",function(states){return _this.insertStateDepth(states,[],[],0);});(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),"stateDecrementer",function(stateMap){var currentIndex=_this.state.ordering.findIndex(function(i){return i===stateMap;});if(currentIndex>0){return _this.state.ordering[currentIndex-1];}else{return _this.state.ordering[currentIndex];}});(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),"stateIncrementer",function(stateMap){var currentIndex=_this.state.ordering.findIndex(function(i){return i===stateMap;});if(currentIndex<_this.state.ordering.length-1){return _this.state.ordering[currentIndex+1];}else{return _this.state.ordering[currentIndex];}});(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),"previousState",function(){var previousStateMap=_this.stateDecrementer(_this.state.currentState);var state=_this.getStateContent(previousStateMap);var complete=_this.checkStateComplete(state.answer);if(complete){_this.markStateComplete(state);}_this.setState({currentState:previousStateMap,activeStateContent:_this.deepTraverseStatesGet(_this.state.states,previousStateMap)});});(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),"nextState",function(){var endState=_this.state.ordering[_this.state.ordering.length-1];if(_this.props.onNextState&&typeof _this.props.onNextState==="function"){_this.props.onNextState(_this.state.activeStateContent);}if(_this.state.currentState===endState){if(_this.props.onFormCompleted&&typeof _this.props.onFormCompleted==="function"){_this.props.onFormCompleted();}}else{var nextStateMap=_this.stateIncrementer(_this.state.currentState);var state=_this.getStateContent(nextStateMap);var complete=_this.checkStateComplete(state.answer);if(complete){_this.markStateComplete(state);}_this.setState({currentState:nextStateMap,activeStateContent:_this.deepTraverseStatesGet(_this.state.states,nextStateMap)});}});(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),"goToState",function(stateMap){var state=_this.getStateContent(stateMap);var complete=_this.checkStateComplete(state.answer);if(complete){_this.markStateComplete(state);}_this.setState({currentState:stateMap,activeStateContent:_this.deepTraverseStatesGet(_this.state.states,stateMap)});});(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),"deepTraverseStatesMutate",function(states,mutateOps){var mergeProps=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};return states.map(function(state){if(state[mutateOps.source.key]===mutateOps.source.value){if(!state[mutateOps.target.key]){state=_objectSpread(_objectSpread({},state),{},(0,_defineProperty2.default)({},mutateOps.target.key,null));}state[mutateOps.target.key]=mutateOps.target.value;state=_objectSpread(_objectSpread({},state),mergeProps);}if(state.states){state.states=_this.deepTraverseStatesMutate(state.states,mutateOps,mergeProps);}return state;});});(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),"deepTraverseStatesGet",function(){var states=arguments.length>0&&arguments[0]!==undefined?arguments[0]:_this.state.states;var stateMap=arguments.length>1?arguments[1]:undefined;for(var _iterator=_createForOfIteratorHelperLoose(states),_step;!(_step=_iterator()).done;){var state=_step.value;if(state.step===stateMap){return state;}if(state.states){var found=_this.deepTraverseStatesGet(state.states,stateMap);if(found){return found;}}continue;}});(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),"setStateAnswer",function(stateMap,answer){_this.initialize(_this.deepTraverseStatesMutate(_this.state.states,{source:{key:"step",value:stateMap},target:{key:"answer",value:answer}}));});(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),"checkStateComplete",function(answer){var isComplete=!!answer;if(_this.state.activeStateContent&&_this.state.activeStateContent.component&&_this.state.activeStateContent.component.props&&_this.state.activeStateContent.component.props.optional){isComplete=true;console.log('set true 1');}if(_this.state.activeStateContent&&_this.state.activeStateContent.component&&_this.state.activeStateContent.component.element==="CustomContentSection"){isComplete=true;console.log('set true 2');}if(_this.state.activeStateContent&&_this.state.activeStateContent.component&&_this.state.activeStateContent.component.props&&_this.state.activeStateContent.component.props.columns){var set=new Set();_this.state.activeStateContent.component.props.choices.forEach(function(choice){set.add(choice.option);});if((0,_typeof2.default)(answer)==="object"){Object.keys(answer).forEach(function(key){set.delete(key);});}if(set.size!==0){isComplete=false;}}return isComplete;});(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),"markStateComplete",function(stateMap){var mergeProps=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};_this.initialize(_this.deepTraverseStatesMutate(_this.state.states,{source:{key:"step",value:stateMap},target:{key:"complete",value:_this.checkStateComplete(mergeProps.answer)}},mergeProps));});(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),"markStateIncomplete",function(stateMap,mergeProps){_this.initialize(_this.deepTraverseStatesMutate(_this.state.states,{source:{key:"step",value:stateMap},target:{key:"complete",value:false}},mergeProps));});(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),"getStateContent",function(stateMap){return _this.deepTraverseStatesGet(_this.state.states,stateMap);});return _this;}(0,_createClass2.default)(FormProvider,[{key:"render",value:function render(){return _react.default.createElement(FormContext.Provider,{value:{static:this.props.static,depths:this.state.depths,ordering:this.state.ordering,states:this.state.states,activeState:this.state.currentState,activeStateContent:this.state.activeStateContent,getState:this.getStateContent,goToState:this.goToState,nextState:this.nextState,previousState:this.previousState,setStateAnswer:this.setStateAnswer,markStateComplete:this.markStateComplete,markStateIncomplete:this.markStateIncomplete,checkStateComplete:this.checkStateComplete,onFormCompleted:this.onFormCompleted,onNextState:this.props.onNextState,cb:this.props.onAnsweredCallback},__source:{fileName:_jsxFileName,lineNumber:307,columnNumber:7}},this.props.children);}}]);return FormProvider;}(_react.Component);exports.FormProvider=FormProvider;(0,_defineProperty2.default)(FormProvider,"propTypes",{static:_propTypes.default.bool,activeState:_propTypes.default.string.isRequired,states:_propTypes.default.array.isRequired,onFormCompleted:_propTypes.default.func.isRequired,onAnsweredCallback:_propTypes.default.func.isRequired});(0,_defineProperty2.default)(FormProvider,"defaultProps",{static:false,completedColor:"PRIMARY_LIGHT",activeState:"1",states:[],onFormCompleted:function onFormCompleted(){console.log("Form Complete");},onAnsweredCallback:function onAnsweredCallback(){console.log("Question Answered");}});var FormConsumer=FormContext.Consumer;exports.FormConsumer=FormConsumer;