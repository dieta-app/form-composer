"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard");Object.defineProperty(exports,"__esModule",{value:true});exports.CityStateQuestion=void 0;var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));var _assertThisInitialized2=_interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));var _inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits"));var _possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));var _getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));var _defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));var _extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends"));var _slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));var _react=_interopRequireWildcard(require("react"));var _styledComponents=_interopRequireWildcard(require("styled-components"));var _propTypes=_interopRequireDefault(require("prop-types"));var _FormProvider=require("../FormProvider");var _TextField=_interopRequireDefault(require("@material-ui/core/TextField"));var _Autocomplete=_interopRequireDefault(require("@material-ui/lab/Autocomplete"));var _LocationOn=_interopRequireDefault(require("@material-ui/icons/LocationOn"));var _Grid=_interopRequireDefault(require("@material-ui/core/Grid"));var _Typography=_interopRequireDefault(require("@material-ui/core/Typography"));var _styles=require("@material-ui/core/styles");var _parse=_interopRequireDefault(require("autosuggest-highlight/parse"));var _lodash=_interopRequireDefault(require("lodash.throttle"));var _jsxFileName="/Users/bneigher/Desktop/Dieta/form-composer/src/Form/Questions/CityStateQuestion.js";function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function(){var Super=(0,_getPrototypeOf2.default)(Derived),result;if(hasNativeReflectConstruct){var NewTarget=(0,_getPrototypeOf2.default)(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return(0,_possibleConstructorReturn2.default)(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true;}catch(e){return false;}}var QuestionContainer=_styledComponents.default.div.withConfig({displayName:"QuestionContainer",componentId:"dbo6q9-0"})(["display:flex;flex:1;flex-direction:column;align-items:center;min-width:275px;"]);function loadScript(src,position,id){if(!position){return;}var script=document.createElement("script");script.setAttribute("async","");script.setAttribute("id",id);script.src=src;position.appendChild(script);}var autocompleteService={current:null};var useStyles=(0,_styles.makeStyles)(function(theme){return{icon:{color:theme.palette.text.secondary,marginRight:theme.spacing(2)}};});var GeoInputContainer=function GeoInputContainer(props){var classes=useStyles();var initialAnswer=props.answer&&props.answer.length?props.answer[0]:"";var _React$useState=_react.default.useState(""),_React$useState2=(0,_slicedToArray2.default)(_React$useState,2),inputValue=_React$useState2[0],setInputValue=_React$useState2[1];var _React$useState3=_react.default.useState([]),_React$useState4=(0,_slicedToArray2.default)(_React$useState3,2),options=_React$useState4[0],setOptions=_React$useState4[1];var loaded=_react.default.useRef(false);if(typeof window!=="undefined"&&!loaded.current){if(!document.querySelector("#google-maps")){if(!window.google_maps_apiKey){window.alert("window.google_maps_apiKey must be provided");}loadScript("https://maps.googleapis.com/maps/api/js?key="+window.google_maps_apiKey+"&libraries=places",document.querySelector("head"),"google-maps");}loaded.current=true;}var handleChange=function handleChange(event){setInputValue(event.target.value);};var handleSelect=function handleSelect(newValue){if(newValue){props.onSelect(newValue.description);}};var fetch=_react.default.useMemo(function(){return(0,_lodash.default)(function(input,callback){autocompleteService.current.getPlacePredictions(input,callback);},200);},[]);_react.default.useEffect(function(){var active=true;if(!autocompleteService.current&&window.google){autocompleteService.current=new window.google.maps.places.AutocompleteService();}if(!autocompleteService.current){return undefined;}if(inputValue===""){setOptions([]);return undefined;}fetch({input:inputValue},function(results){if(active){setOptions(results||[]);}});return function(){active=false;};},[inputValue,fetch]);return _react.default.createElement(_Autocomplete.default,{id:"google-map-demo",defaultValue:{description:initialAnswer},style:{width:300},getOptionLabel:function getOptionLabel(option){return option.description;},filterOptions:function filterOptions(x){return x;},options:options,autoComplete:true,includeInputInList:true,freeSolo:true,onChange:function onChange(e,value){return handleSelect(value);},renderInput:function renderInput(params){return _react.default.createElement(_TextField.default,(0,_extends2.default)({},params,{label:"City, State",variant:"outlined",fullWidth:true,onChange:handleChange,__source:{fileName:_jsxFileName,lineNumber:129,columnNumber:11}}));},renderOption:function renderOption(option){var matches=option.structured_formatting.main_text_matched_substrings;var parts=(0,_parse.default)(option.structured_formatting.main_text,matches.map(function(match){return[match.offset,match.offset+match.length];}));return _react.default.createElement(_Grid.default,{container:true,alignItems:"center",__source:{fileName:_jsxFileName,lineNumber:147,columnNumber:11}},_react.default.createElement(_Grid.default,{item:true,__source:{fileName:_jsxFileName,lineNumber:148,columnNumber:13}},_react.default.createElement(_LocationOn.default,{className:classes.icon,__source:{fileName:_jsxFileName,lineNumber:149,columnNumber:15}})),_react.default.createElement(_Grid.default,{item:true,xs:true,__source:{fileName:_jsxFileName,lineNumber:151,columnNumber:13}},parts.map(function(part,index){return _react.default.createElement("span",{key:index,style:{fontWeight:part.highlight?700:400},__source:{fileName:_jsxFileName,lineNumber:153,columnNumber:17}},part.text);}),_react.default.createElement(_Typography.default,{variant:"body2",color:"textSecondary",__source:{fileName:_jsxFileName,lineNumber:163,columnNumber:15}},option.structured_formatting.secondary_text)));},__source:{fileName:_jsxFileName,lineNumber:113,columnNumber:5}});};var CityStateQuestion=function(_Component){(0,_inherits2.default)(CityStateQuestion,_Component);var _super=_createSuper(CityStateQuestion);function CityStateQuestion(){var _this;(0,_classCallCheck2.default)(this,CityStateQuestion);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),"onClick",function(question,choice,cb,context){if(!context.static){if(cb&&typeof cb==="function"){cb({question:question,answer:[choice]},context);}}});return _this;}(0,_createClass2.default)(CityStateQuestion,[{key:"componentDidMount",value:function componentDidMount(){}},{key:"componentDidUpdate",value:function componentDidUpdate(){}},{key:"render",value:function render(){var _this2=this;return _react.default.createElement(_styledComponents.ThemeContext.Consumer,{__source:{fileName:_jsxFileName,lineNumber:202,columnNumber:7}},function(themeContext){return _react.default.createElement(_FormProvider.FormConsumer,{__source:{fileName:_jsxFileName,lineNumber:205,columnNumber:13}},function(context){return _react.default.createElement(QuestionContainer,{__source:{fileName:_jsxFileName,lineNumber:208,columnNumber:19}},_react.default.createElement(GeoInputContainer,{isStatic:context.static,answer:_this2.props.answer,onSelect:function onSelect(answer){return _this2.onClick(context.activeStateContent.question,answer,context.cb,context);},__source:{fileName:_jsxFileName,lineNumber:209,columnNumber:21}}));});});}}]);return CityStateQuestion;}(_react.Component);exports.CityStateQuestion=CityStateQuestion;(0,_defineProperty2.default)(CityStateQuestion,"propTypes",{answer:_propTypes.default.array.isRequired});(0,_defineProperty2.default)(CityStateQuestion,"defaultProps",{answer:[]});